<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <title>Histórico de Leads - Fortal</title>
    <%- include('partials/head') %>
</head>

<body class="min-h-screen page-history">

    <%- include('partials/macos-toolbar', { title: 'Histórico de Leads' , username: username, profile_pic_url:
        profile_pic_url }) %>
        <%- include('partials/macos-sidebar', { user: user }) %>

            <main class="macos-main-content">
                <div class="animate-fade-in" style="padding-bottom: 40px; max-width: 1200px; margin: 0 auto;">

                    <!-- Header -->
                    <div class="flex items-center justify-between mb-8">
                        <div>
                            <h1 class="text-3xl font-bold text-[var(--macos-text-primary)] mb-2">Histórico de
                                Distribuição</h1>
                            <p class="text-[var(--macos-text-secondary)]">Monitore quem assumiu cada lead e o status
                                atual.</p>
                        </div>
                        <a href="/leads" class="macos-btn-secondary">
                            <i class="fa-solid fa-arrow-left mr-2"></i> Voltar para Piscina
                        </a>
                    </div>

                    <!-- Leads History Table -->
                    <div class="macos-card p-0 overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead>
                                    <tr class="bg-[var(--macos-bg-tertiary)] border-b border-[var(--macos-divider)]">
                                        <th
                                            class="p-4 text-xs font-semibold text-[var(--macos-text-secondary)] uppercase tracking-wider">
                                            Data</th>
                                        <th
                                            class="p-4 text-xs font-semibold text-[var(--macos-text-secondary)] uppercase tracking-wider">
                                            Lead</th>
                                        <th
                                            class="p-4 text-xs font-semibold text-[var(--macos-text-secondary)] uppercase tracking-wider">
                                            Assumido Por</th>
                                        <th
                                            class="p-4 text-xs font-semibold text-[var(--macos-text-secondary)] uppercase tracking-wider">
                                            Perfil</th>
                                        <th
                                            class="p-4 text-xs font-semibold text-[var(--macos-text-secondary)] uppercase tracking-wider">
                                            Status</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-[var(--macos-divider)]">
                                    <% if (leads && leads.length> 0) { %>
                                        <% leads.forEach(lead=> { %>
                                            <tr class="hover:bg-[var(--macos-bg-secondary)] transition-colors">
                                                <!-- Data -->
                                                <td class="p-4 text-sm text-[var(--macos-text-secondary)]">
                                                    <%= new Date(lead.updated_at).toLocaleString() %>
                                                </td>

                                                <!-- Lead -->
                                                <td class="p-4">
                                                    <div class="font-semibold text-[var(--macos-text-primary)]">
                                                        <%= lead.nome %>
                                                    </div>
                                                    <div class="text-xs text-[var(--macos-text-tertiary)]">
                                                        <%= lead.whatsapp %>
                                                    </div>
                                                </td>

                                                <!-- Assessor -->
                                                <td class="p-4">
                                                    <% if (lead.assessor_nome) { %>
                                                        <div class="flex items-center gap-2">
                                                            <% if (lead.assessor_pic) { %>
                                                                <img src="<%= lead.assessor_pic %>"
                                                                    class="w-6 h-6 rounded-full">
                                                                <% } else { %>
                                                                    <div
                                                                        class="w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center text-xs text-blue-500 font-bold">
                                                                        <%= lead.assessor_nome.charAt(0).toUpperCase()
                                                                            %>
                                                                    </div>
                                                                    <% } %>
                                                                        <span
                                                                            class="text-sm font-medium text-[var(--macos-text-primary)]">
                                                                            <%= lead.assessor_nome %>
                                                                        </span>
                                                        </div>
                                                        <% } else { %>
                                                            <span class="text-xs text-slate-400 italic">Sistema /
                                                                Ninguém</span>
                                                            <% } %>
                                                </td>

                                                <!-- Perfil -->
                                                <td class="p-4">
                                                    <div class="flex flex-col gap-1">
                                                        <span
                                                            class="text-xs text-[var(--macos-text-primary)] capitalize">
                                                            <i
                                                                class="<%= lead.objetivo === 'investir' ? 'fa-solid fa-chart-line text-green-500' : 'fa-solid fa-house text-blue-500' %> mr-1"></i>
                                                            <%= lead.objetivo %>
                                                        </span>
                                                        <span
                                                            class="text-xs px-2 py-0.5 rounded-full w-fit <%= lead.preferencia_pgto === 'vista' ? 'bg-green-500/10 text-green-500' : 'bg-blue-500/10 text-blue-500' %>">
                                                            <%= lead.preferencia_pgto==='vista' ? 'À Vista'
                                                                : 'Financiado' %>
                                                        </span>
                                                    </div>
                                                </td>

                                                <!-- Status -->
                                                <td class="p-4">
                                                    <span class="macos-badge macos-badge-success uppercase text-[10px]">
                                                        <%= lead.status %>
                                                    </span>
                                                </td>
                                            </tr>
                                            <% }); %>
                                                <% } else { %>
                                                    <tr>
                                                        <td colspan="5"
                                                            class="p-8 text-center text-[var(--macos-text-tertiary)]">
                                                            <p>Nenhum histórico encontrado.</p>
                                                        </td>
                                                    </tr>
                                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </main>
</body>

</html>